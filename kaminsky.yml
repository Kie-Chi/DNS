name: "kaminsky"
inet: 10.102.0.0/24
include: 
  - resource:/includes/traffic.yml
images:
  - name: "bind"
    ref: "bind:9.18.0"
  - name: "myrecursor"
    ref: "bind:9.4.3"
  - name: "attacker"
    ref: "python:3.9.0"

builds:
  recursor:
    image: "myrecursor"
    ref: "std:recursor"
    behavior: . hint fake-auth
    volumes:
      - rndc.key:/usr/local/etc/rndc.key
      - ${origin}./${name}/named:/usr/local/var/named:rw
  attacker:
    image: "attacker"
    volumes:
      - git://github.com/Kie-Chi/Cpings.git#.:/usr/local/etc/Cpings
    command: ["tail", "-f", "/dev/null"]
  auth:
    image: "bind"
    ref: "std:auth"
    behavior: |
      . master com NS auth
      com master example NS auth
      example.com master www A 1.2.3.4
  fake-auth:
    image: "attacker"
    volumes:
      - server.py:/usr/local/etc/server.py
    command: ["python3", "/usr/local/etc/server.py"]
  traffic:
    environment:
      - "RECURSOR=${services.recursor.ip}"
      - "ATTACKER=${services.attacker.ip}"
      - "SOFTWARE=${services.recursor.image.software}"
    volumes:
      - rndc.key:/usr/local/etc/rndc.key
      - resource:/scripts/py/trace.py:/usr/local/etc/trace.py
      - resource:/scripts/py/bind.py:/usr/local/etc/bind.py
      - ${origin}./recursor/named:/usr/local/var/named:rw
